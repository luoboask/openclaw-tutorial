1:"$Sreact.fragment"
2:I[9113,["177","static/chunks/app/layout-46f5ac64a413e030.js"],"GoogleAnalytics"]
3:I[9766,[],""]
4:I[8924,[],""]
6:I[4431,[],"OutletBoundary"]
8:I[5278,[],"AsyncMetadataOutlet"]
a:I[4431,[],"ViewportBoundary"]
c:I[4431,[],"MetadataBoundary"]
d:"$Sreact.suspense"
f:I[7150,[],""]
:HL["/_next/static/css/0d6fcd825e447727.css","style"]
0:{"P":null,"b":"QWlEvMVWvC7lS0YxRQeSa","p":"","c":["","blog","openclaw-memory-system-deep-dive",""],"i":false,"f":[[["",{"children":["blog",{"children":[["slug","openclaw-memory-system-deep-dive","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/0d6fcd825e447727.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"zh-CN","children":[["$","head",null,{"children":["$","$L2",null,{}]}],["$","body",null,{"className":"antialiased bg-white text-gray-900","children":["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]]}]]}],{"children":["blog",["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slug","openclaw-memory-system-deep-dive","d"],["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L5",null,["$","$L6",null,{"children":["$L7",["$","$L8",null,{"promise":"$@9"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,[["$","$La",null,{"children":"$Lb"}],null],["$","$Lc",null,{"children":["$","div",null,{"hidden":true,"children":["$","$d",null,{"fallback":null,"children":"$Le"}]}]}]]}],false]],"m":"$undefined","G":["$f",[]],"s":false,"S":true}
10:I[2619,["619","static/chunks/619-ba102abea3e3d0e4.js","953","static/chunks/app/blog/%5Bslug%5D/page-7164898cb9c00029.js"],""]
11:T80e,p-8 md:p-12 
  prose prose-lg max-w-none
  prose-headings:text-gray-900
  prose-h1:text-3xl prose-h1:font-bold prose-h1:mb-6 prose-h1:pb-4 prose-h1:border-b prose-h1:border-gray-200
  prose-h2:text-2xl prose-h2:font-semibold prose-h2:mt-10 prose-h2:mb-4 prose-h2:pb-3 prose-h2:border-b prose-h2:border-gray-200
  prose-h3:text-xl prose-h3:font-semibold prose-h3:mt-8 prose-h3:mb-3
  prose-h4:text-lg prose-h4:font-semibold prose-h4:mt-6 prose-h4:mb-2
  prose-p:text-gray-700 prose-p:leading-relaxed prose-p:mb-4
  prose-a:text-blue-600 prose-a:no-underline hover:prose-a:underline
  prose-strong:text-gray-900 prose-strong:font-semibold
  prose-blockquote:border-l-4 prose-blockquote:border-orange-500 prose-blockquote:bg-orange-50 
  prose-blockquote:pl-5 prose-blockquote:pr-4 prose-blockquote:py-3 prose-blockquote:my-4 
  prose-blockquote:rounded-r prose-blockquote:text-orange-900
  prose-code:bg-gray-100 prose-code:text-gray-800 prose-code:px-1.5 prose-code:py-0.5 
  prose-code:rounded prose-code:text-sm prose-code:font-mono prose-code:border prose-code:border-gray-200
  prose-pre:bg-gray-900 prose-pre:text-gray-100 prose-pre:p-4 prose-pre:rounded-lg 
  prose-pre:overflow-x-auto prose-pre:my-4
  prose-pre:code:bg-transparent prose-pre:code:text-gray-100 prose-pre:code:p-0 prose-pre:code:border-0
  prose-ul:list-disc prose-ul:list-inside prose-ul:text-gray-700 prose-ul:mb-4 prose-ul:space-y-2
  prose-ol:list-decimal prose-ol:list-inside prose-ol:text-gray-700 prose-ol:mb-4 prose-ol:space-y-2
  prose-li:text-gray-700
  prose-table:w-full prose-table:border-collapse prose-table:border prose-table:border-gray-300 
  prose-table:bg-white prose-table:rounded-lg prose-table:overflow-hidden prose-table:my-4
  prose-thead:bg-gray-100
  prose-th:text-left prose-th:font-semibold prose-th:text-gray-900 prose-th:p-3 
  prose-th:border prose-th:border-gray-300
  prose-td:text-gray-700 prose-td:p-3 prose-td:border prose-td:border-gray-300
  prose-tr:border-t prose-tr:border-gray-300 even:prose-tr:bg-gray-50
  prose-hr:my-8 prose-hr:border-gray-200
12:T206d,<h1>OpenClaw 记忆系统技术详解</h1>
<p>本文深入解析 OpenClaw AI 助手的记忆系统架构、工作原理和实现细节。</p>
<p>适用版本：OpenClaw 2026.2.x</p>
<hr>
<h2>概述</h2>
<p>OpenClaw 采用混合架构设计，结合文件系统存储和向量语义搜索，实现高效、隐私友好的长期记忆功能。</p>
<h3>核心设计理念</h3>
<p><strong>双轨记忆系统</strong></p>
<ul>
<li><strong>长期记忆</strong> (MEMORY.md)：精心维护的核心知识，持久化存储，跨会话共享</li>
<li><strong>短期记忆</strong> (memory/*.md)：每日自动追加的日志，按日期分片</li>
</ul>
<p><strong>混合检索引擎</strong></p>
<ul>
<li>向量搜索（语义相似度）—— 权重 70%</li>
<li>BM25 全文（关键词）—— 权重 30%</li>
<li>FTS5（SQLite）—— 辅助索引</li>
</ul>
<p><strong>设计哲学</strong></p>
<ul>
<li>文件优先：纯 Markdown，人类可读可编辑</li>
<li>隐私优先：本地存储，不依赖云服务</li>
<li>渐进式记忆：长期记忆精选 + 短期记忆全量</li>
</ul>
<h3>文件系统结构</h3>
<pre><code>~/.openclaw/workspace/
├── MEMORY.md                    # 长期记忆
├── memory/                      # 短期记忆目录
│   ├── 2026-02-14.md
│   ├── 2026-02-17.md
│   └── 2026-02-18.md
└── agents/{id}/memory/          # Agent 专属记忆
</code></pre>
<hr>
<h2>向量搜索原理</h2>
<h3>文本向量化</h3>
<p>将文本转换为高维向量（768-4096 维）。</p>
<p><strong>示例</strong></p>
<blockquote>
<p>"OpenClaw Agent 工作机制"</p>
<p>经过嵌入模型处理后 → 768 维向量数组</p>
</blockquote>
<p><strong>语义特性</strong></p>
<ul>
<li>相似的文本在向量空间中距离近</li>
<li>"苹果"和"水果"向量接近</li>
<li>"苹果"和"iPhone"在特定语境下也接近</li>
</ul>
<h3>相似度计算</h3>
<p>使用<strong>余弦相似度</strong>：</p>
<pre><code>similarity = (A·B) / (||A|| × ||B||)

范围: -1 ~ 1
阈值: >0.5 认为相关
</code></pre>
<h3>分块策略</h3>
<p>| 参数 | 值 | 说明 |
|------|-----|------|
| chunkSize | 400 tokens | 每块大小 |
| overlap | 80 tokens | 重叠保持上下文 |
| strategy | tokens | 按 token 分割 |</p>
<p><strong>分块目的</strong></p>
<ol>
<li>控制向量粒度（太长会稀释语义）</li>
<li>支持精确检索（找到具体段落）</li>
<li>避免上下文窗口溢出</li>
</ol>
<hr>
<h2>混合搜索策略</h2>
<h3>向量搜索 vs 关键词搜索</h3>
<p>| 方式 | 优势 | 劣势 | 适用场景 |
|------|------|------|---------|
| 向量搜索 | 语义理解、同义词 | 精确术语匹配差 | 概念搜索 |
| BM25/FTS | 精确匹配、速度快 | 无法理解语义 | 代码、ID、错误信息 |</p>
<h3>BM25 算法</h3>
<p>BM25（Best Match 25）比简单的"出现次数"更智能，考虑三个因素：</p>
<p><strong>1. 词频（TF）</strong></p>
<p>不是线性增长：</p>
<ul>
<li>出现 1 次 → 基础分</li>
<li>出现 2 次 → 分数增加，但不如 2 倍</li>
<li>出现 10 次 → 分数饱和（防止关键词堆砌）</li>
</ul>
<p><strong>公式</strong></p>
<pre><code>score = (TF × (k1 + 1)) / (TF + k1 × (1 - b + b × (doc_len / avg_len)))

k1 = 1.2（控制词频饱和度）
b = 0.75（控制文档长度惩罚）
</code></pre>
<p><strong>2. 逆文档频率（IDF）</strong></p>
<ul>
<li>常见词（如"的"）→ 出现在 99% 文档 → IDF 很低</li>
<li>专业词（如"OpenClaw"）→ 只出现在 5% 文档 → IDF 很高</li>
</ul>
<p><strong>3. 文档长度归一化</strong></p>
<ul>
<li>100字文档出现1次"Agent" → 密度 1%</li>
<li>10000字文档出现10次"Agent" → 密度 0.1%（实际相关性更低）</li>
</ul>
<h3>FTS 全文搜索</h3>
<p>FTS 使用<strong>倒排索引</strong>，比传统搜索快 100-1000 倍。</p>
<p>| 搜索方式 | 原理 | 速度 |
|---------|------|------|
| 传统搜索 | 线性扫描每个文档 | O(n) |
| FTS 搜索 | 直接查倒排索引 | O(1) |</p>
<p><strong>FTS5 优势</strong></p>
<ul>
<li>比 LIKE '%关键词%' 快 100-1000 倍</li>
<li>自动按匹配度排序</li>
<li>支持布尔查询（AND / OR / NOT）</li>
</ul>
<hr>
<h2>数据库存储</h2>
<h3>SQLite + 扩展</h3>
<ul>
<li>标准表：files, chunks, meta</li>
<li>FTS5 虚拟表：全文检索</li>
<li>sqlite-vec 扩展：向量相似度计算</li>
</ul>
<h3>核心数据表</h3>
<p><strong>files 表</strong> —— 文件元数据</p>
<p>| 字段 | 说明 |
|------|------|
| path | 文件路径 |
| source | 来源（memory/sessions）|
| hash | 内容哈希（检测变化）|
| mtime | 修改时间 |
| size | 文件大小 |</p>
<p><strong>chunks 表</strong> —— 核心数据</p>
<p>| 字段 | 说明 |
|------|------|
| id | 唯一标识 |
| path | 所属文件 |
| source | 来源 |
| start_line / end_line | 行号范围 |
| hash | 内容哈希 |
| model | 使用的嵌入模型 |
| text | 原始文本 |
| embedding | 序列化向量 |</p>
<h3>Agent 隔离</h3>
<p>每个 Agent 拥有独立的数据库，保证数据安全和隐私。</p>
<hr>
<h2>写入时机</h2>
<h3>四种触发时机</h3>
<ol>
<li><strong>会话启动时</strong> —— 检查记忆文件变化，同步到 SQLite</li>
<li><strong>搜索前</strong> —— 确保搜索结果是最新的</li>
<li><strong>文件变化时</strong> —— 1.5秒防抖后触发同步</li>
<li><strong>定时同步</strong> —— 每30分钟自动同步一次</li>
</ol>
<h3>批量处理机制</h3>
<p><strong>非批量的问题</strong></p>
<pre><code>100 个 chunks
→ 100 次 API 调用
→ 100 次数据库写入
→ 非常慢！
</code></pre>
<p><strong>批量的优化</strong></p>
<pre><code>100 个 chunks
→ 1 次 API 调用
→ 1 次事务写入
→ 快 10-100 倍！
</code></pre>
<p><strong>配置参数</strong></p>
<p>| 参数 | 值 | 说明 |
|------|-----|------|
| enabled | true | 启用批量 |
| maxSize | 100 | 每批最多 chunks |
| concurrency | 4 | 并发批数 |
| intervalMs | 1000 | 批次间隔 |
| timeoutMs | 120000 | 超时时间 |</p>
<h3>索引流程</h3>
<pre><code>1. 触发条件满足
2. 扫描文件系统，计算哈希
3. 对比数据库，识别变化
4. 批量处理变化
5. 更新 files 表
6. 提交事务
</code></pre>
<hr>
<h2>配置选项</h2>
<h3>嵌入提供商</h3>
<p>支持三种方式：</p>
<ol>
<li><strong>远程 API</strong> —— OpenAI / Gemini</li>
<li><strong>Ollama 本地</strong> —— 推荐，免费</li>
<li><strong>本地 GGUF</strong> —— 完全离线</li>
</ol>
<h3>搜索配置</h3>
<p>| 参数 | 说明 |
|------|------|
| hybrid.enabled | 启用混合搜索 |
| vectorWeight | 向量权重（默认 70%）|
| textWeight | 文本权重（默认 30%）|
| minScore | 最低相似度阈值 |
| maxResults | 最大返回结果数 |</p>
<hr>
<h2>性能优化</h2>
<p>| 优化项 | 效果 |
|--------|------|
| sqlite-vec 扩展 | 向量计算加速 |
| 嵌入缓存 | 避免重复计算 |
| 批量索引 | 减少 I/O |
| 调整 chunkSize | 默认 400，可增大减少块数 |
| 定期清理旧日志 | 控制索引规模 |</p>
<hr>
<h2>常见问题</h2>
<p>| 问题 | 原因 | 解决方案 |
|------|------|---------|
| 搜索无结果 | 相似度低于阈值 | 降低 minScore |
| 结果不相关 | 向量/文本权重不当 | 调整 vectorWeight |
| 索引慢 | 嵌入模型慢 | 换更快的模型或使用缓存 |
| GGUF 加载失败 | 兼容性问题 | 使用 Ollama 替代 |</p>
<hr>
<h2>总结</h2>
<p>OpenClaw 记忆系统的核心技术：</p>
<ol>
<li><strong>文件系统存储</strong> —— 纯 Markdown，人类可读</li>
<li><strong>向量语义搜索</strong> —— 理解同义词和上下文</li>
<li><strong>BM25 + FTS</strong> —— 精确关键词匹配</li>
<li><strong>混合融合算法</strong> —— 综合语义和关键词优势</li>
<li><strong>批量处理机制</strong> —— 优化性能和资源使用</li>
<li><strong>Agent 隔离</strong> —— 保证数据安全和隐私</li>
</ol>
<p>这套架构平衡了搜索质量、隐私保护和性能效率，是 OpenClaw 成为优秀 AI 助手的关键基础设施。</p>
<hr>
<p><em>文档版本: 1.0</em><br>
<em>最后更新: 2026-02-24</em><br>
<em>作者: OpenClaw Assistant</em></p>
5:["$","div",null,{"className":"min-h-screen bg-gradient-to-b from-slate-50 to-white","children":["$","div",null,{"className":"max-w-4xl mx-auto px-4 py-12","children":[["$","$L10",null,{"href":"/blog","className":"text-gray-600 hover:text-orange-600 mb-8 block","children":"返回博客"}],["$","article",null,{"className":"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden","children":[["$","div",null,{"className":"bg-gradient-to-br from-orange-500 to-red-600 p-12 text-white","children":[["$","div",null,{"className":"flex items-center gap-4 mb-4 text-sm opacity-90","children":[["$","span",null,{"children":"2026-02-24"}],["$","span",null,{"children":"30 分钟"}]]}],["$","h1",null,{"className":"text-3xl font-bold","children":"OpenClaw 记忆系统技术详解"}]]}],["$","div",null,{"className":"$11","dangerouslySetInnerHTML":{"__html":"$12"}}]]}]]}]}]
b:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
7:null
9:{"metadata":[["$","title","0",{"children":"OpenClaw 中文教程 - 自托管 AI 网关"}],["$","meta","1",{"name":"description","content":"OpenClaw 中文教程网站 - 学习如何部署和配置 OpenClaw，将 AI 助手接入 WhatsApp、Telegram、Discord 等聊天应用"}],["$","meta","2",{"name":"author","content":"OpenClaw 中文社区"}],["$","meta","3",{"name":"keywords","content":"OpenClaw, AI, 自托管, WhatsApp, Telegram, Discord, 教程"}],["$","meta","4",{"property":"og:title","content":"OpenClaw 中文教程"}],["$","meta","5",{"property":"og:description","content":"自托管 AI 网关，连接你的所有聊天应用"}],["$","meta","6",{"property":"og:type","content":"website"}],["$","meta","7",{"name":"twitter:card","content":"summary"}],["$","meta","8",{"name":"twitter:title","content":"OpenClaw 中文教程"}],["$","meta","9",{"name":"twitter:description","content":"自托管 AI 网关，连接你的所有聊天应用"}]],"error":null,"digest":"$undefined"}
e:"$9:metadata"
